{% extends "base.html" %}
{% load i18n %}  <!-- Load internationalization module for translating text -->
{% load static %} <!-- Load static files module for serving static assets -->
{% load timestamps %} <!-- Load timestamps module for handling timestamp operations -->

{% block title %}{% trans "User profile at Weblate" %}{% endblock %}

{% block content %}

 <!-- Page for User services with translation support -->
<section class="content">
    <div class="row">
        <div class="wrap">
            {% with services=user.service_set.all %}
            <!-- Retrieve user services -->
            {% if services %}
            <div class="updated-service-title">
              <h1>
                {% trans "My services" %}
              </h1>
              <div class="page-desc">
                  <a href="https://care.weblate.org/" class="button inline">{% trans "Support portal" %}</a>
                  <!-- Button for support portal -->
                  <a href="https://hosted.weblate.org/accounts/profile/#account" class="button inline border rev" target="_blank">{% trans "See user profile" %}</a>
                  <!-- Button to see user profile with translation support -->
              </div>
            </div>
            {% for service in services %}
            {% include "snippets/service.html" %}
            <!-- Include service snippet template -->
            {% endfor %}
            {% endif %}
            {% endwith %}

            <div class="page-desc">
              <!-- Description section -->
              <a class="button inline" href="{% url "support" %}">{% trans "Get support" %}</a>
              <!-- Button to get support with translation support -->
              <a class="button inline border rev" href="{% url "service-discovery-add" %}">{% trans "Add server to Discover Weblate" %}</a>
              <!-- Button to add server to Discover Weblate with translation support -->
            </div>

            <h1>{% trans "My donations" %}</h1>

            {% for donation in user.donation_set.all %}
            <div class="payment-form payment-padding">
                <div class="form-line donation-left-line">
                    <div class="line-left get-reward-left-line">{{ donation.get_reward_display }}</div>
                    {% if donation.reward %}
                      <div class="reward-line-right">{% trans "Your reward" %}</div>
                      <!-- Display user reward with translation support -->
                    {% endif %}
                </div>
                <div class="form-line custom-gradient"></div>
                <div class="inner-content">
                    <div class="inner-content-child-width">
                {% if donation.link_url or donation.reward %}
                <!-- Check if there's a donation link or reward -->
                <div class="form-line user-text-formatting">
                    <div class="line-left">{% trans "Link" %}</div>
                    <div class="line-right user-text-formatting-donation">
                      {{ donation.link_url }}
                      <a class="button small inline" href="{% url "donate-edit" pk=donation.pk %}">{% trans "Edit reward" %}</a>
                      <!-- Button to edit donation reward with translation support -->
                    </div>
                    <div class="clear"></div>
                </div>
                {% endif %}
                <div class="form-line user-text-formatting">
                    <div class="line-left">{% trans "Active" %}</div>
                    <!-- Display active status with translation support -->
                    <div class="line-right user-text-formatting-donation">{% date_range donation.created donation.expires True %}
                        <!-- Calculate date range -->
                        {% with days_from_today_donation=donation.expires|days_diff_from_today %}
                        <!-- Calculate days from today -->
                        {% if days_from_today_donation < 30 %}
                        <!-- Check if donation expires within 30 days -->
                        {% if days_from_today_donation < 2 and days_from_today_donation >= 0 %}
                        <!-- Check if donation expires within 2 days -->
                        <t class="orange">{{ days_from_today_donation | days_remaining}}</t>
                        <!-- Display remaining days in orange -->
                        {% elif days_from_today_donation < 0  %}
                        <t class="pl-1 orange">{% trans "Expired" %}</t>
                        {% else %}
                        <t class="orange">{{ days_from_today_donation | days_remaining}}</t>
                        {% endif %}
                        {% else %}
                        <t class="grey">{{ days_from_today_donation | days_remaining}}</t>
                        {% endif %}
                        {% endwith %}
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="form-line user-text-formatting">
                    <div class="line-left">
                        {% if not donation.active %}
                        <!-- Check if donation is not active -->
                        {% trans "Expired" %}
                        <!-- Display expired status with translation support -->
                        {% elif donation.payment_obj.recurring %}
                        <!-- Check if donation has recurring payment -->
                        {% trans "Automatic renewal" %}
                        <!-- Display automatic renewal status with translation support -->
                        {% else %}
                        {% trans "No renewal" %}
                        <!-- Display no renewal status with translation support -->
                        {% endif %}
                    </div>

                    <div class="line-right user-text-formatting-donation">
                        {% if donation.active and donation.payment_obj.recurring %}
                        <!-- Check if donation is active and has recurring payment -->
                        <form class="form-float" method="post" action="{% url "donate-disable" pk=donation.pk %}">
                        {% csrf_token %}
                        <input type="submit" class="link" value="{% trans "Turn off renewal" %}">
                        <!-- Form to turn off renewal with translation support -->
                        </form>
                        {% endif %}
                        {% if not donation.active %}
                        {% trans "Expired" %}
                        {% elif donation.payment_obj.recurring %}
                        {% trans "Automatic renewal" %}
                        {% else %}
                        {% trans "No renewal" %}
                        {% endif %}
                        <br />
                        <form class="form-inline" method="post" action="{% url "donate-pay" pk=donation.pk %}">
                        {% csrf_token %}
                        <input type="submit" class="button button-med-140 inline" value="{% trans "Renew now" %}">
                        <!-- Form to renew donation with translation support -->
                        </form>
                    </div>
                    <div class="clear"></div>
                </div>
                    </div>
            <div class="inner-content-child-width-auto">
                <img src="{% static "img/donations-picture.png" %}" alt="Puppy">
            </div>
            </div>
            <div class="payment-updated">
            <div class="form-line user-text-formatting user-text-formatting-payment">
                <div class="line-left">{% trans "Payments" %}</div>
                <div class="line-right ">
                <table class="payments-table">
                {% for payment in donation.list_payments %}
                <!-- Loop through payments -->
                {% include "snippets/payment.html" %}
                <!-- Include payment snippet template -->
                {% endfor %}
                </table>

                </div>

                </div>
            </div>
            </div>
            {% empty %}
                <div class="payment-form-donationbox">
                    <!-- Donation box section -->
                    <div class="line-right-donationbox">{% trans "Wanna see something nice here?" %}</div>
                    <a class="button" href="{% url "donate" %}">{% trans "Donate now" %}</a>
                </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
